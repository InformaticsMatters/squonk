---

# Deploy Keycloak secrets.

- name: Login (user)
  command: oc login {{ oc_master_url }} -u {{ oc_user }} -p {{ oc_user_password }}
  changed_when: False

- name: Move to Infrastructure Project
  command: oc project {{ oc_infra_project }}
  changed_when: False

# Check and deploy...

- name: Check Secrets
  command: oc get secrets
  register: secret_result
  changed_when: False

- name: Deploy Keycloak Secrets
  shell: >
    oc process -f {{ role_path }}/files/keycloak-secrets.yaml
    -p SSO_ADMIN_USERNAME={{ oc_keycloak_user }}
    -p SSO_ADMIN_PASSWORD={{ oc_keycloak_password }}
    | oc create -f -
  when: '"keycloak-secrets" not in secret_result.stdout'
